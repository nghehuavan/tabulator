<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title></title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <link href="https://unpkg.com/tabulator-tables@5.5.2/dist/css/tabulator.min.css" rel="stylesheet">
  <script type="text/javascript" src="https://unpkg.com/tabulator-tables@5.5.2/dist/js/tabulator.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/luxon/3.4.4/luxon.min.js"></script>
</head>

<body>
  <h1> 1 custom colums (2 sort) by 2 hidden column</h1>

  <div id="example-table"></div>
  <button type="button" onclick="showAllColumns();">show 2 hidden column</button>
  <script>
    var tabledata = [
      { id: 1, name: "Oli Bob", progress: 12, gender: "male", rating: 1, col: "red", dob: "19/02/1984", car: 1, money: 10000000, check: false, type: '' },
      { id: 2, name: "Mary May", progress: 1, gender: "female", rating: 2, col: "blue", dob: "14/05/1982", car: true, money: 10000000, check: true, type: '1' },
      { id: 3, name: "Christin", progress: 42, gender: "female", rating: 0, col: "green", dob: "22/05/1982", car: "true", money: 10000000, check: false, type: '2' },
      { id: 4, name: "Brendon", progress: 100, gender: "male", rating: 1, col: "orange", dob: "01/08/1980", money: 10000000, check: false, type: '' },
      { id: 5, name: "Margret", progress: 16, gender: "female", rating: 5, col: "yellow", dob: "31/01/1999", money: 10000000, check: false, type: '' },
      { id: 6, name: "Frank ", progress: 38, gender: "male", rating: 4, col: "red", dob: "12/05/1966", car: 1, money: 10000000, check: false, type: '' },
    ];

    // create custom formatter
    var moneyFormater = function (cell, formatterParams) {
      console.log(cell.getData());
      var formatter = document.createElement("input");
      formatter.setAttribute("type", "text");
      formatter.value = numberWithDots(cell.getValue());
      formatter.addEventListener("focus", () => {
        formatter.value = removeDots(formatter.value);
      });

      successFunc = () => {
        var oldValue = cell.getValue();
        var newValue = removeDots(formatter.value);
        if (newValue != oldValue) {
          cell.setValue(newValue);
          console.log(tabledata)
        }
        formatter.value = numberWithDots(cell.getValue());
      }
      formatter.addEventListener("change", successFunc);
      formatter.addEventListener("blur", successFunc);

      return formatter;
    }

    // create custom formatter
    var checkFormater = function (cell, formatterParams) {
      var formatter = document.createElement("input");
      formatter.setAttribute("type", "checkbox");
      formatter.checked = cell.getValue();
      successFunc = () => {
        cell.setValue(formatter.checked);
        console.log(tabledata)
      }
      formatter.addEventListener("change", successFunc);
      return formatter;
    }

    var radioFormater = function (cell, formatterParams) {
      var row = cell.getRow();
      var data = row.getData();
      var formatter = document.createElement("input");
      formatter.setAttribute("type", "radio");
      formatter.setAttribute("name", `radio_${formatterParams.radioName}_${row.getIndex()}`);
      formatter.checked = data.type == formatterParams.checkedValue;
      // console.log(data.type)
      successFunc = () => {
        data.type = formatterParams.checkedValue
        console.log(tabledata)
      }
      formatter.addEventListener("change", successFunc);
      return formatter;
    }

    var resetFormater = function (cell, formatterParams) {
      var row = cell.getRow();
      var data = row.getData();
      var formatter = document.createElement("input");
      formatter.setAttribute("type", "button");
      formatter.setAttribute("value", "reset");
      successFunc = () => {
        data.type = ""
        data.check = false
        table.replaceData(tabledata)
        console.log(tabledata)
      }
      formatter.addEventListener("click", successFunc);
      return formatter;
    }

    var table = new Tabulator("#example-table", {
      data: tabledata,
      // reactiveData: true,
      height: "311px",
      columns: [
        { title: "Name", field: "name", visible: false },
        { title: "Gender", field: "gender", visible: false },
        {
          title: "Name_Gender",
          titleFormatter: function (cell, formatterParams, onRendered) {
            return `<a href="#" onclick="sortBy('name');return false;">Name (click sort)</a><br/><a href="#" onclick="sortBy('gender');return false;">Gender (click sort)</a>`;
          },
          field: "__FullName",
          hozAlign: "center",
          headerSort: false,
          mutator: function (value, data, type, params, component) {
            return `${data.name} (${data.gender}) `;
          }
        },

        { title: "Progress", field: "progress", sorter: "number" },
        { title: "Rating", field: "rating" },
        { title: "Favourite Color", field: "col" },
        { title: "Date Of Birth", field: "dob", hozAlign: "center" },
        {
          title: "Money", field: "money", hozAlign: "center",
          formatter: moneyFormater,
        },
        {
          title: "Check",
          titleFormatter: function (cell, formatterParams, onRendered) {
            return `<input id="checkAll" type="checkbox" onchange="toggleCheckAll();return false;">`;
          },
          headerSort: false,
          field: "check", hozAlign: "center", sort: false,
          formatter: checkFormater,
        },
        { title: "Type1", field: "type", hozAlign: "center", headerSort: false, formatter: radioFormater, formatterParams: { radioName: "type", checkedValue: "1" }, },
        { title: "Type2", field: "type", hozAlign: "center", headerSort: false, formatter: radioFormater, formatterParams: { radioName: "type", checkedValue: "2" }, },
        {
          title: "", field: "type", hozAlign: "center", formatter: resetFormater,
        },
      ],
    });

    function sortBy(field) {
      var currentSorts = table.getSorters();
      console.log(currentSorts);
      var currentSort = currentSorts.find((s) => s.field == field);
      if (currentSort) {
        var dir = currentSort.dir == "asc" ? "desc" : "asc"
        table.setSort(field, dir);
      } else {
        table.setSort(field, "desc");
      }
    }

    function toggleCheckAll() {
      var checked = document.getElementById("checkAll").checked;
      for (let i = 0; i < tabledata.length; i++) {
        tabledata[i].check = checked;
      }
      table.replaceData(tabledata);
    }

    function showAllColumns() {
      table.getColumns().forEach(function (column) {
        column.show(); // shows the column
      });

    }

    function numberWithDots(x) {
      return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }

    function removeDots(x) {
      return x.toString().replaceAll(",", "");
    }


    console.log(numberWithDots(10000000000))
  </script>
</body>

</html>